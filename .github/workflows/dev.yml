name: Deploy to dev server 
on:
  push:
    branches:
      - dev
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
    - name: Deploy to dev server 
      env:
        PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
        HOST: 49.13.230.22
        USER: root
        container_name: custody-keys-bridge-dev
      run: |
        echo "$PRIVATE_KEY" > private_key 
        chmod 600 private_key
         ssh -i private_key   -o StrictHostKeyChecking=no  $USER@$HOST  " 
           cd /root/dev/custody-keys-bridge
           git pull 
           docker build -t $container_name . 
           docker stop $container_name  && docker rm $container_name
           docker run -d -p 5000:3003 --name=$container_name  --restart=unless-stopped  $container_name "
